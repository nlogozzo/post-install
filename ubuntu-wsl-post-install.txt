# NOTE
# Replace 'nlogozzo' with your WSL username
# Replace 'nlogo' with your Windows username (Found in C:\Users)

# Before starting, make sure WSL is running the latest version
# In PowerShell run the following:
wsl.exe --update

# Update
sudo apt update -y && sudo apt upgrade -y
sudo apt install -y wget unzip git nano software-properties-common build-essential procps curl file

# Ensure Systemd
sudo nano /etc/wsl.conf
# Add the following lines:
[boot]
systemd=true

# Restart WSL
cd /mnt/c/ && cmd.exe /c start "Rebooting WSL" cmd /c "timeout 5 && title "Ubuntu" && wsl -d Ubuntu" && wsl.exe --terminate Ubuntu

# Setup Terminal Look & Feel
sudo add-apt-repository ppa:zhangsongcui3371/fastfetch
sudo apt update -y
sudo apt install -y fastfetch
sudo wget https://github.com/JanDeDobbeleer/oh-my-posh/releases/latest/download/posh-linux-amd64 -O /usr/local/bin/oh-my-posh
sudo chmod +x /usr/local/bin/oh-my-posh
mkdir ~/.poshthemes
wget https://github.com/JanDeDobbeleer/oh-my-posh/releases/latest/download/themes.zip -O ~/.poshthemes/themes.zip
unzip ~/.poshthemes/themes.zip -d ~/.poshthemes
chmod u+rw ~/.poshthemes/*.json
rm ~/.poshthemes/themes.zip
echo 'eval "$(oh-my-posh --init --shell bash --config ~/.poshthemes/jandedobbeleer.omp.json)"' >> ~/.bashrc
echo "fastfetch" >> ~/.bashrc

# Install Software
sudo add-apt-repository ppa:ubuntu-toolchain-r/test
sudo add-apt-repository universe
sudo add-apt-repository ppa:flatpak/stable
sudo add-apt-repository ppa:tomtomtom/yt-dlp
sudo add-apt-repository ppa:ubuntuhandbook1/ffmpeg7
sudo apt update -y
sudo apt install -y firefox gcc-13 g++-13 xdg-user-dirs xdg-user-dirs-gtk flatpak libfuse2 flatpak-builder gettext yelp-tools pkg-config tzdata locales dotnet-sdk-8.0 dotnet-runtime-8.0 ruby ninja-build meson sassc libcurl4-gnutls-dev libjsoncpp-dev libssl-dev libgtest-dev libgmock-dev libsecret-1-dev dbus-x11 gnome-keyring yt-dlp aria2 ffmpeg x11proto-core-dev qt6-base-dev qt6-tools-dev libqt6svg6-dev libgl1-mesa-dev
 
# Install brew
/bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"
(echo; echo 'eval "$(/home/linuxbrew/.linuxbrew/bin/brew shellenv)"') >> ~/.bashrc
echo 'export XDG_DATA_DIRS="/home/linuxbrew/.linuxbrew/share:$XDG_DATA_DIRS"' >> ~/.bashrc
eval "$(/home/linuxbrew/.linuxbrew/bin/brew shellenv)"
echo "export PKG_CONFIG_PATH=/usr/lib/pkgconfig:/home/linuxbrew/.linuxbrew/lib/pkgconfig:$PKG_CONFIG_PATH" >> ~/.bashrc
echo 'export LDFLAGS="-L/home/linuxbrew/.linuxbrew/lib"' >> ~/.bashrc
echo 'export CPPFLAGS="-I/home/linuxbrew/.linuxbrew/include"' >> ~/.bashrc
brew install cmake gtk4 libadwaita glib libxml++@5 boost python-setuptools pygobject3 libsecret

# Install adw-gtk3
cd ~
git clone https://github.com/lassekongo83/adw-gtk3.git
cd adw-gtk3
meson build
cd build
sudo ninja install
cd ~
rm -rf adw-gtk3

# Install blueprint-compiler
cd ~
git clone https://gitlab.gnome.org/jwestman/blueprint-compiler
cd blueprint-compiler
meson build
cd build
sudo ninja install
cd ~
rm -rf blueprint-compiler

# Install maddy
cd ~
git clone --depth 1 --branch "1.3.0" https://github.com/progsource/maddy
sudo mkdir -p /usr/include/maddy
sudo mv maddy/include/maddy/* /usr/include/maddy
rm -rf ~/maddy

# Install libnick
cd ~
git clone --depth 1 --branch "2024.8.1" https://github.com/NickvisionApps/libnick/
mkdir -p libnick/build
cd libnick/build
cmake .. -DCMAKE_BUILD_TYPE=Release -DBUILD_TESTING="OFF" -DCMAKE_INSTALL_PREFIX=/usr
cmake --build .
sudo cmake --install .
rm -rf ~/libnick
cd ~

# Setup Keyring Unlock
echo 'read -rsp "Password: " pass' >> ~/.bashrc
echo 'export $(echo -n "$pass" | gnome-keyring-daemon --replace --unlock)' >> ~/.bashrc
echo 'unset pass' >>  ~/.bashrc
echo 'echo ""' >> ~/.bashrc

# Restart WSL
cd /mnt/c/ && cmd.exe /c start "Rebooting WSL" cmd /c "timeout 5 && title "Ubuntu" && wsl -d Ubuntu" && wsl.exe --terminate Ubuntu

# Configure Flatpak
flatpak --user remote-add --if-not-exists flathub https://dl.flathub.org/repo/flathub.flatpakrepo
flatpak --user remote-add --if-not-exists flathub-beta https://flathub.org/beta-repo/flathub-beta.flatpakrepo
flatpak --user update
flatpak --user install -y flathub org.gnome.Sdk//46 org.gnome.Platform//46 org.gtk.Gtk3theme.adw-gtk3 org.gtk.Gtk3theme.adw-gtk3-dark org.nickvision.tagger org.nickvision.tubeconverter org.nickvision.money org.nickvision.cavalier re.sonny.Workbench org.gnome.design.IconLibrary com.github.tchx84.Flatseal

# Configure User
xdg-user-dirs-update
xdg-user-dirs-gtk-update
sudo locale-gen en_US.UTF-8
sudo update-locale LANG=en_US.UTF-8
sudo update-alternatives --install /usr/bin/gcc gcc /usr/bin/gcc-13 100
sudo update-alternatives --install /usr/bin/g++ g++ /usr/bin/g++-13 100
sudo update-alternatives --install /usr/bin/cmake cmake /home/linuxbrew/.linuxbrew/bin/cmake 100
git config --global submodule.recurse true
git config --global protocol.file.allow always
git config --global http.postBuffer 524288000
gsettings set org.gnome.desktop.interface gtk-theme 'adw-gtk3-dark'
gsettings set org.gnome.desktop.interface color-scheme 'prefer-dark'
ln -s /mnt/c/Users/nlogo ~/winhome
